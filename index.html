<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simple Platformer with Finish Line</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#87ceeb, #b3e5fc);
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 450;

const gravity = 0.6;
let keys = {};

class Player {
  constructor() {
    this.width = 40;
    this.height = 60;
    this.x = 100;
    this.y = canvas.height - this.height - 50;
    this.dy = 0;
    this.speed = 5;
    this.jumpPower = 12;
    this.onGround = false;
  }

  draw() {
    ctx.fillStyle = "#ff5733";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }

  update(platforms) {
    // Horizontal movement
    if (keys["ArrowRight"]) this.x += this.speed;
    if (keys["ArrowLeft"]) this.x -= this.speed;

    // Gravity
    this.y += this.dy;
    this.dy += gravity;

    // Check platform collisions
    this.onGround = false;
    for (let p of platforms) {
      if (
        this.x < p.x + p.width &&
        this.x + this.width > p.x &&
        this.y + this.height <= p.y + this.dy &&
        this.y + this.height + this.dy >= p.y
      ) {
        this.dy = 0;
        this.y = p.y - this.height;
        this.onGround = true;
      }
    }

    // Floor limit
    if (this.y + this.height > canvas.height) {
      this.y = canvas.height - this.height;
      this.dy = 0;
      this.onGround = true;
    }

    this.draw();
  }

  jump() {
    if (this.onGround) {
      this.dy = -this.jumpPower;
      this.onGround = false;
    }
  }
}

class Platform {
  constructor(x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
  }

  draw() {
    ctx.fillStyle = "#5D4037";
    ctx.fillRect(this.x, this.y, this.width, this.height);
    ctx.fillStyle = "#795548";
    ctx.fillRect(this.x, this.y, this.width, 5); // top edge
  }
}

const player = new Player();
const levelLength = 2400;
const platforms = [
  new Platform(0, canvas.height - 30, levelLength, 30),
  new Platform(150, 350, 100, 15),
  new Platform(400, 280, 120, 15),
  new Platform(650, 200, 100, 15),
  new Platform(900, 330, 150, 15),
  new Platform(1150, 270, 100, 15),
  new Platform(1400, 230, 120, 15),
  new Platform(1650, 300, 100, 15),
  new Platform(1900, 250, 120, 15),
  new Platform(2150, 350, 100, 15)
];

// Finish line flag
const finishLineX = levelLength - 100;

function drawFinishLine(offsetX) {
  const flagX = finishLineX - offsetX;
  const flagY = canvas.height - 150;
  ctx.fillStyle = "#555";
  ctx.fillRect(flagX, flagY, 5, 120); // pole
  ctx.fillStyle = "#FFD700";
  ctx.beginPath();
  ctx.moveTo(flagX + 5, flagY);
  ctx.lineTo(flagX + 60, flagY + 20);
  ctx.lineTo(flagX + 5, flagY + 40);
  ctx.closePath();
  ctx.fill();
  ctx.font = "20px Arial";
  ctx.fillStyle = "#000";
  ctx.fillText("üèÅ", flagX + 15, flagY - 10);
}

let cameraOffsetX = 0;

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Smooth camera follow
  cameraOffsetX = player.x - canvas.width / 2 + player.width / 2;
  if (cameraOffsetX < 0) cameraOffsetX = 0;
  if (cameraOffsetX > levelLength - canvas.width)
    cameraOffsetX = levelLength - canvas.width;

  // Draw background ground texture
  ctx.fillStyle = "#4CAF50";
  ctx.fillRect(-cameraOffsetX, canvas.height - 30, levelLength, 30);
  ctx.fillStyle = "#2E7D32";
  for (let i = 0; i < levelLength; i += 40) {
    ctx.fillRect(i - cameraOffsetX, canvas.height - 25, 20, 5);
  }

  // Draw platforms
  platforms.forEach(p => {
    ctx.save();
    ctx.translate(-cameraOffsetX, 0);
    p.draw();
    ctx.restore();
  });

  // Draw finish line
  drawFinishLine(cameraOffsetX);

  // Update player
  ctx.save();
  ctx.translate(-cameraOffsetX, 0);
  player.update(platforms);
  ctx.restore();

  // Check for win condition
  if (player.x > finishLineX) {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = "40px Arial";
    ctx.fillText("You reached the finish line!", 180, 200);
  } else {
    requestAnimationFrame(animate);
  }
}

animate();

// Controls
window.addEventListener("keydown", e => {
  keys[e.key] = true;
  if (e.key === " " || e.key === "ArrowUp") player.jump();
});
window.addEventListener("keyup", e => keys[e.key] = false);
</script>
</body>
</html>
